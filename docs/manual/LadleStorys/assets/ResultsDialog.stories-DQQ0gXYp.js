import{o as e,s as t,q as n,t as r,u as s,v as i,w as o,r as l,m as a,j as d,x as u,y as c,k as m,z as p,A as x}from"./index-DvxvgMDz.js";import{m as h,n as v,b as f,u as j,H as N,f as y,j as S,k as w,d as A}from"./PageContext-DroK59Kk.js";import{b as b,f as z,c as O,a as T,d as U,u as B,e as H,n as I,g as ee,h as en}from"./create-slot-recipe-context-N7Bc4o6x.js";import{c as er,a as es,H as ei,B as eo,T as el}from"./h-stack-CM-3ku_d.js";import{V as ea,C as ed,S as eu}from"./v-stack-B0jmgAEy.js";let V=e=>b()(e,["immediate","lazyMount","onExitComplete","present","skipAnimationOnMount","unmountOnExit"]);function Ae(e,t){let{state:n,send:r,context:s}=e,i=n.matches("mounted","unmountSuspended");return{skip:!s.get("initial"),present:i,setNode(e){e&&r({type:"NODE.SET",node:e})},unmount(){r({type:"UNMOUNT"})}}}var Me=e({props:({props:e})=>({...e,present:!!e.present}),initialState:({prop:e})=>e("present")?"mounted":"unmounted",refs:()=>({node:null,styles:null}),context:({bindable:e})=>({unmountAnimationName:e(()=>({defaultValue:null})),prevAnimationName:e(()=>({defaultValue:null})),present:e(()=>({defaultValue:!1})),initial:e(()=>({sync:!0,defaultValue:!1}))}),exit:["clearInitial","cleanupNode"],watch({track:e,prop:t,send:n}){e([()=>t("present")],()=>{n({type:"PRESENCE.CHANGED"})})},on:{"NODE.SET":{actions:["setupNode"]},"PRESENCE.CHANGED":{actions:["setInitial","syncPresence"]}},states:{mounted:{on:{UNMOUNT:{target:"unmounted",actions:["clearPrevAnimationName","invokeOnExitComplete"]},"UNMOUNT.SUSPEND":{target:"unmountSuspended"}}},unmountSuspended:{effects:["trackAnimationEvents"],on:{MOUNT:{target:"mounted",actions:["setPrevAnimationName"]},UNMOUNT:{target:"unmounted",actions:["clearPrevAnimationName","invokeOnExitComplete"]}}},unmounted:{on:{MOUNT:{target:"mounted",actions:["setPrevAnimationName"]}}}},implementations:{actions:{setInitial:({context:e})=>{e.get("initial")||queueMicrotask(()=>{e.set("initial",!0)})},clearInitial:({context:e})=>{e.set("initial",!1)},invokeOnExitComplete:({prop:e})=>{var t;null==(t=e("onExitComplete"))||t()},setupNode:({refs:e,event:t})=>{e.get("node")!==t.node&&(e.set("node",t.node),e.set("styles",s(t.node)))},cleanupNode:({refs:e})=>{e.set("node",null),e.set("styles",null)},syncPresence:({context:e,refs:t,send:n,prop:s})=>{let i=s("present");if(i)return n({type:"MOUNT",src:"presence.changed"});let o=t.get("node");if(!i&&(null==o?void 0:o.ownerDocument.visibilityState)==="hidden")return n({type:"UNMOUNT",src:"visibilitychange"});r(()=>{var r,s;let i=k(t.get("styles"));e.set("unmountAnimationName",i),"none"===i||i===e.get("prevAnimationName")||(null==(r=t.get("styles"))?void 0:r.display)==="none"||(null==(s=t.get("styles"))?void 0:s.animationDuration)==="0s"?n({type:"UNMOUNT",src:"presence.changed"}):n({type:"UNMOUNT.SUSPEND"})})},setPrevAnimationName:({context:e,refs:t})=>{r(()=>{e.set("prevAnimationName",k(t.get("styles")))})},clearPrevAnimationName:({context:e})=>{e.set("prevAnimationName",null)}},effects:{trackAnimationEvents:({context:e,refs:r,send:s,prop:o})=>{let l=r.get("node");if(!l)return;let a=t=>{var n,s;((null==(s=null==(n=t.composedPath)?void 0:n.call(t))?void 0:s[0])??t.target)===l&&e.set("prevAnimationName",k(r.get("styles")))},d=t=>{let n=k(r.get("styles"));i(t)!==l||n!==e.get("unmountAnimationName")||o("present")||s({type:"UNMOUNT",src:"animationend"})};l.addEventListener("animationstart",a),l.addEventListener("animationcancel",d),l.addEventListener("animationend",d);let u=t(l,{animationFillMode:"forwards"});return()=>{l.removeEventListener("animationstart",a),l.removeEventListener("animationcancel",d),l.removeEventListener("animationend",d),n(()=>u())}}}}});function k(e){return(null==e?void 0:e.animationName)||"none"}function Le(e,t={}){let{sync:n=!1}=t,r=ze(e);return l.useCallback((...e)=>{var t;return n?queueMicrotask(()=>{var t;return null==(t=r.current)?void 0:t.call(r,...e)}):null==(t=r.current)?void 0:t.call(r,...e)},[n,r])}function ze(e){let t=l.useRef(e);return t.current=e,t}o()(["onExitComplete","present","immediate"]);let M=(e={})=>{let{lazyMount:t,unmountOnExit:n,present:r,skipAnimationOnMount:s=!1,...i}=e,o=l.useRef(!1),a=Ae(z(Me,{...i,present:r,onExitComplete:Le(e.onExitComplete)}));a.present&&(o.current=!0);let d=!a.present&&!o.current&&t||n&&!a.present&&o.current;return{ref:a.setNode,getPresenceProps:()=>({"data-state":a.skip&&s?void 0:r?"open":"closed",hidden:!a.present}),present:a.present,unmounted:d}},[$,L]=O({name:"PresenceContext",hookName:"usePresenceContext",providerName:"<PresenceProvider />"}),[F,Ue]=O({name:"RenderStrategyContext",hookName:"useRenderStrategyContext",providerName:"<RenderStrategyPropsProvider />"}),G=e=>b()(e,["lazyMount","unmountOnExit"]),[W,P]=O({name:"DialogContext",hookName:"useDialogContext",providerName:"<DialogProvider />"}),q=l.forwardRef((e,t)=>{let n=P(),r=M({...Ue(),present:n.open}),s=a(n.getBackdropProps(),r.getPresenceProps(),e);return r.unmounted?null:d.jsx(T.div,{...s,ref:U(r.ref,t)})});q.displayName="DialogBackdrop";let _=l.forwardRef((e,t)=>{let n=a(P().getCloseTriggerProps(),e);return d.jsx(T.button,{...n,ref:t})});_.displayName="DialogCloseTrigger";let K=l.forwardRef((e,t)=>{let n=P(),r=L(),s=a(n.getContentProps(),r.getPresenceProps(),e);return r.unmounted?null:d.jsx(T.div,{...s,ref:U(r.ref,t)})});K.displayName="DialogContent";let Z=l.forwardRef((e,t)=>{let n=a(P().getDescriptionProps(),e);return d.jsx(T.div,{...n,ref:t})});Z.displayName="DialogDescription";let J=l.forwardRef((e,t)=>{let n=a(P().getPositionerProps(),e);return L().unmounted?null:d.jsx(T.div,{...n,ref:t})});J.displayName="DialogPositioner";let Oe=e=>{let t=l.useId(),{getRootNode:n}=B(),{dir:r}=H();return u(z(c,{id:t,getRootNode:n,dir:r,...e}),I)},Be=e=>{let[t,{children:n,...r}]=V(e),[s]=G(t),i=Oe(r),o=M(a({present:i.open},t));return d.jsx(W,{value:i,children:d.jsx(F,{value:s,children:d.jsx($,{value:o,children:n})})})},be=e=>{let[t,{value:n,children:r}]=V(e),[s]=G(t),i=M(a({present:n.open},t));return d.jsx(W,{value:n,children:d.jsx(F,{value:s,children:d.jsx($,{value:i,children:r})})})},Q=l.forwardRef((e,t)=>{let n=a(P().getTitleProps(),e);return d.jsx(T.h2,{...n,ref:t})});Q.displayName="DialogTitle";let X=l.forwardRef((e,t)=>{let n=P(),r=L(),s=a({...n.getTriggerProps(),"aria-controls":r.unmounted?void 0:n.getTriggerProps()["aria-controls"]},e);return d.jsx(T.button,{...s,ref:t})});X.displayName="DialogTrigger";let He=e=>{var t;let{children:n,disabled:r}=e,[s,i]=l.useState(null==(t=e.container)?void 0:t.current),o=l.useSyncExternalStore(Ve,()=>!1,()=>!0),{getRootNode:a}=B();if(l.useEffect(()=>{i(()=>{var t;return null==(t=e.container)?void 0:t.current})},[e.container]),o||r)return d.jsx(d.Fragment,{children:n});let u=s??Ie(a);return d.jsx(d.Fragment,{children:l.Children.map(n,e=>m.createPortal(e,u))})},Ie=e=>{let t=null==e?void 0:e(),n=t.getRootNode();return p(n)?n:x(t).body},Ve=()=>()=>{},$e=e=>d.jsxs(er.svg,{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"3",strokeLinecap:"round",strokeLinejoin:"round",...e,children:[d.jsx("path",{d:"m5 12 7-7 7 7"}),d.jsx("path",{d:"M12 19V5"})]}),Fe=e=>d.jsxs(er.svg,{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"3",strokeLinecap:"round",strokeLinejoin:"round",...e,children:[d.jsx("path",{d:"M12 5v14"}),d.jsx("path",{d:"m19 12-7 7-7-7"})]}),Ge=e=>d.jsx(er.svg,{viewBox:"0 0 24 24",fill:"currentColor",...e,children:d.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M18.7071 6.70711C19.0976 6.31658 19.0976 5.68342 18.7071 5.29289C18.3166 4.90237 17.6834 4.90237 17.2929 5.29289L12 10.5858L6.70711 5.29289C6.31658 4.90237 5.68342 4.90237 5.29289 5.29289C4.90237 5.68342 4.90237 6.31658 5.29289 6.70711L10.5858 12L5.29289 17.2929C4.90237 17.6834 4.90237 18.3166 5.29289 18.7071C5.68342 19.0976 6.31658 19.0976 6.70711 18.7071L12 13.4142L17.2929 18.7071C17.6834 19.0976 18.3166 19.0976 18.7071 18.7071C19.0976 18.3166 19.0976 17.6834 18.7071 17.2929L13.4142 12L18.7071 6.70711Z"})}),We=l.forwardRef(function(e,t){return d.jsx(es,{px:"0",py:"0",_icon:{fontSize:"1.2em"},ref:t,...e})}),qe=l.forwardRef(function(e,t){return d.jsx(We,{variant:"ghost","aria-label":"Close",ref:t,...e,children:e.children??d.jsx(Ge,{})})}),{withRootProvider:Y,withContext:g}=ee({key:"dialog"});Y(be,{defaultProps:{unmountOnExit:!0,lazyMount:!0}});let _e=Y(Be,{defaultProps:{unmountOnExit:!0,lazyMount:!0}});g(X,"trigger",{forwardAsChild:!0});let Ke=g(J,"positioner",{forwardAsChild:!0}),Ze=g(K,"content",{forwardAsChild:!0});g(Z,"description",{forwardAsChild:!0});let Je=g(Q,"title",{forwardAsChild:!0}),Qe=g(_,"closeTrigger",{forwardAsChild:!0}),Xe=l.forwardRef(function(e,t){let n=P();return d.jsx(er.button,{...e,ref:t,onClick:()=>n.setOpen(!1)})}),Ye=g(q,"backdrop",{forwardAsChild:!0}),et=g("div","body"),tt=g("div","footer"),nt=g("div","header"),{withProvider:ot,withContext:C,PropsProvider:st}=ee({key:"stat"}),D=ot("dl","root"),E=C("dt","label"),R=C("dd","valueText");function rt({open:e,setOpen:t,onRetry:n,setShouldBgmPlay:r,summary:s}){let i=h(),o=v(),l=f(),a=j();return d.jsx(_e,{open:e,onOpenChange:e=>t(e.open),size:"sm",placement:"center",onExitComplete:()=>{s.killedNow&&o(i+1),t(!1)},children:d.jsxs(He,{children:[d.jsx(Ye,{}),d.jsx(Ke,{children:d.jsxs(Ze,{rounded:"xl",children:[d.jsxs(nt,{children:[d.jsx(Je,{children:"けっか発表"}),d.jsx(Qe,{asChild:!0,children:d.jsx(qe,{size:"sm"})})]}),d.jsxs(et,{children:[d.jsxs(ei,{gap:"6",wrap:"wrap",children:[d.jsxs(D,{children:[d.jsx(E,{children:"時間"}),d.jsxs(R,{fontSize:"2xl",children:[s.timeSec,"s"]})]}),!a&&d.jsxs(D,{children:[d.jsx(E,{children:"ヒントを使った問題数"}),d.jsx(R,{fontSize:"2xl",children:s.usedHintCount})]}),d.jsxs(D,{children:[d.jsx(E,{children:"まちがえた問題数"}),d.jsx(R,{fontSize:"2xl",children:s.mistakeProblemCount})]})]}),s.killedNow&&d.jsxs(eo,{children:["レベルが",i,"から",i+1,"に上がった"]})]}),d.jsxs(tt,{gap:"2",children:[d.jsx(es,{colorPalette:"blue",onClick:()=>{l&&r(!1),n()},children:"もう一度やる"}),d.jsx(Xe,{asChild:!0,children:d.jsx(es,{variant:"outline",onClick:()=>{l&&r(!0)},children:"とじる"})})]})]})})]})})}C("span","helpText"),C("span","valueUnit"),C("span","indicator",{defaultProps:{"data-type":"up",children:d.jsx($e,{})}}),C("span","indicator",{defaultProps:{"data-type":"down",children:d.jsx(Fe,{})}}),l.forwardRef(function(e,t){let n=en({key:"stat"}),[r,s]=l.useMemo(()=>n.splitVariantProps(e),[e,n]);return d.jsx(st,{value:r,children:d.jsx(er.div,{ref:t,role:"group",display:"flex",flexWrap:"wrap",justifyContent:"space-around",alignItems:"flex-start",...s})})});let mt={title:"Components/typing/ResultsDialog"},it=({battle:e,level:t,setLevel:n,sound:r,children:s})=>d.jsx(y.Provider,{value:e,children:d.jsx(S.Provider,{value:t,children:d.jsx(w.Provider,{value:n,children:d.jsx(A.Provider,{value:r,children:s})})})}),pt=()=>{let[e,t]=l.useState(!0),[n,r]=l.useState(!0),[s,i]=l.useState(!0),[o,a]=l.useState(3),[u,c]=l.useState(42),[m,p]=l.useState(2),[x,h]=l.useState(1),[v,f]=l.useState(!0),[j,y]=l.useState(!1),S=l.useMemo(()=>({timeSec:u,usedHintCount:m,mistakeProblemCount:x,killedNow:v}),[u,m,x,v]);return d.jsx(it,{battle:n,level:o,setLevel:a,sound:s,children:d.jsxs(eo,{p:"6",children:[d.jsxs(ea,{align:"stretch",gap:"3",mb:"4",children:[d.jsx(N,{size:"md",children:"Playground"}),d.jsxs(ei,{gap:"2",flexWrap:"wrap",children:[d.jsx(es,{size:"sm",onClick:()=>t(!0),children:"ダイアログを開く"}),d.jsx(es,{size:"sm",variant:"outline",onClick:()=>t(!1),children:"ダイアログを閉じる"}),d.jsxs(es,{size:"sm",variant:"outline",onClick:()=>r(e=>!e),children:["battle 切替: ",String(n)]}),d.jsxs(es,{size:"sm",variant:"outline",onClick:()=>i(e=>!e),children:["sound 切替: ",String(s)]}),d.jsx(es,{size:"sm",onClick:()=>a(e=>Math.max(1,e-1)),children:"Lv -1"}),d.jsx(es,{size:"sm",onClick:()=>a(e=>e+1),children:"Lv +1"}),d.jsx(es,{size:"sm",onClick:()=>c(e=>Math.max(0,e-5)),children:"timeSec -5"}),d.jsx(es,{size:"sm",onClick:()=>c(e=>e+5),children:"timeSec +5"}),d.jsx(es,{size:"sm",onClick:()=>p(e=>Math.max(0,e-1)),children:"hint -1"}),d.jsx(es,{size:"sm",onClick:()=>p(e=>e+1),children:"hint +1"}),d.jsx(es,{size:"sm",onClick:()=>h(e=>Math.max(0,e-1)),children:"mistake -1"}),d.jsx(es,{size:"sm",onClick:()=>h(e=>e+1),children:"mistake +1"}),d.jsxs(es,{size:"sm",variant:"outline",onClick:()=>f(e=>!e),children:["killedNow 切替: ",String(v)]})]}),d.jsxs(eo,{fontSize:"sm",children:[d.jsx(ed,{mr:"2",children:"open"}),String(e),d.jsx(ed,{mx:"2",children:"battle"}),String(n),d.jsx(ed,{mx:"2",children:"sound"}),String(s),d.jsx(ed,{mx:"2",children:"level"}),o,d.jsx(ed,{mx:"2",children:"timeSec"}),u,d.jsx(ed,{mx:"2",children:"usedHintCount"}),m,d.jsx(ed,{mx:"2",children:"mistakeProblemCount"}),x,d.jsx(ed,{mx:"2",children:"killedNow"}),String(v),d.jsx(ed,{mx:"2",children:"bgmShouldPlay"}),String(j)]}),d.jsx(eu,{}),d.jsxs(el,{fontSize:"sm",opacity:.8,children:["・battle=false の場合は「ヒントを使った問題数」が表示されます。",d.jsx("br",{}),"・killedNow=true の場合は「レベルアップ (Lv → Lv+1)」が表示され、閉じる時に useSetLevel によりレベルが+1されます。"]})]}),d.jsx(rt,{open:e,setOpen:t,onRetry:()=>{h(0),p(0),c(0),t(!0),console.log("[ResultsDialog] onRetry called")},setShouldBgmPlay:y,summary:S})]})})};"u">typeof window&&window.document&&window.document.createElement&&document.documentElement.setAttribute("data-storyloaded","");export{pt as Basic,mt as default};