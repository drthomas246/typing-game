import{o as re,s as ie,q as ae,t as z,u as le,v as ce,w as de,r as a,m as f,j as t,x as ue,y as me,k as pe,z as ge,A as xe}from"./index-BOAeCiy-.js";import{m as he,n as fe,b as ve,u as Pe,H as je,f as Ce,j as Se,k as Ne,d as ke}from"./PageContext-8aCNvY1K.js";import{b as U,f as O,c as A,a as j,d as B,u as b,e as ye,n as we,g as H,h as De}from"./create-slot-recipe-context-DMfPMyLG.js";import{c as S,a as m,H as I,B as T,T as Ee}from"./h-stack-DMiR_jPW.js";import{V as Re,C as h,S as Te}from"./v-stack-CxHTt__7.js";const V=e=>U()(e,["immediate","lazyMount","onExitComplete","present","skipAnimationOnMount","unmountOnExit"]);function Ae(e,n){const{state:o,send:s,context:r}=e,i=o.matches("mounted","unmountSuspended");return{skip:!r.get("initial"),present:i,setNode(l){l&&s({type:"NODE.SET",node:l})},unmount(){s({type:"UNMOUNT"})}}}var Me=re({props({props:e}){return{...e,present:!!e.present}},initialState({prop:e}){return e("present")?"mounted":"unmounted"},refs(){return{node:null,styles:null}},context({bindable:e}){return{unmountAnimationName:e(()=>({defaultValue:null})),prevAnimationName:e(()=>({defaultValue:null})),present:e(()=>({defaultValue:!1})),initial:e(()=>({sync:!0,defaultValue:!1}))}},exit:["clearInitial","cleanupNode"],watch({track:e,prop:n,send:o}){e([()=>n("present")],()=>{o({type:"PRESENCE.CHANGED"})})},on:{"NODE.SET":{actions:["setupNode"]},"PRESENCE.CHANGED":{actions:["setInitial","syncPresence"]}},states:{mounted:{on:{UNMOUNT:{target:"unmounted",actions:["clearPrevAnimationName","invokeOnExitComplete"]},"UNMOUNT.SUSPEND":{target:"unmountSuspended"}}},unmountSuspended:{effects:["trackAnimationEvents"],on:{MOUNT:{target:"mounted",actions:["setPrevAnimationName"]},UNMOUNT:{target:"unmounted",actions:["clearPrevAnimationName","invokeOnExitComplete"]}}},unmounted:{on:{MOUNT:{target:"mounted",actions:["setPrevAnimationName"]}}}},implementations:{actions:{setInitial:({context:e})=>{e.get("initial")||queueMicrotask(()=>{e.set("initial",!0)})},clearInitial:({context:e})=>{e.set("initial",!1)},invokeOnExitComplete:({prop:e})=>{var n;(n=e("onExitComplete"))==null||n()},setupNode:({refs:e,event:n})=>{e.get("node")!==n.node&&(e.set("node",n.node),e.set("styles",le(n.node)))},cleanupNode:({refs:e})=>{e.set("node",null),e.set("styles",null)},syncPresence:({context:e,refs:n,send:o,prop:s})=>{const r=s("present");if(r)return o({type:"MOUNT",src:"presence.changed"});const i=n.get("node");if(!r&&(i==null?void 0:i.ownerDocument.visibilityState)==="hidden")return o({type:"UNMOUNT",src:"visibilitychange"});z(()=>{var p,u;const l=k(n.get("styles"));e.set("unmountAnimationName",l),l==="none"||l===e.get("prevAnimationName")||((p=n.get("styles"))==null?void 0:p.display)==="none"||((u=n.get("styles"))==null?void 0:u.animationDuration)==="0s"?o({type:"UNMOUNT",src:"presence.changed"}):o({type:"UNMOUNT.SUSPEND"})})},setPrevAnimationName:({context:e,refs:n})=>{z(()=>{e.set("prevAnimationName",k(n.get("styles")))})},clearPrevAnimationName:({context:e})=>{e.set("prevAnimationName",null)}},effects:{trackAnimationEvents:({context:e,refs:n,send:o,prop:s})=>{const r=n.get("node");if(!r)return;const i=u=>{var x,v;(((v=(x=u.composedPath)==null?void 0:x.call(u))==null?void 0:v[0])??u.target)===r&&e.set("prevAnimationName",k(n.get("styles")))},l=u=>{const c=k(n.get("styles"));ce(u)===r&&c===e.get("unmountAnimationName")&&!s("present")&&o({type:"UNMOUNT",src:"animationend"})};r.addEventListener("animationstart",i),r.addEventListener("animationcancel",l),r.addEventListener("animationend",l);const p=ie(r,{animationFillMode:"forwards"});return()=>{r.removeEventListener("animationstart",i),r.removeEventListener("animationcancel",l),r.removeEventListener("animationend",l),ae(()=>p())}}}}});function k(e){return(e==null?void 0:e.animationName)||"none"}de()(["onExitComplete","present","immediate"]);function Le(e,n={}){const{sync:o=!1}=n,s=ze(e);return a.useCallback((...r)=>{var i;return o?queueMicrotask(()=>{var l;return(l=s.current)==null?void 0:l.call(s,...r)}):(i=s.current)==null?void 0:i.call(s,...r)},[o,s])}function ze(e){const n=a.useRef(e);return n.current=e,n}const M=(e={})=>{const{lazyMount:n,unmountOnExit:o,present:s,skipAnimationOnMount:r=!1,...i}=e,l=a.useRef(!1),p={...i,present:s,onExitComplete:Le(e.onExitComplete)},u=O(Me,p),c=Ae(u);c.present&&(l.current=!0);const x=!c.present&&!l.current&&n||o&&!c.present&&l.current,v=()=>({"data-state":c.skip&&r?void 0:s?"open":"closed",hidden:!c.present});return{ref:c.setNode,getPresenceProps:v,present:c.present,unmounted:x}},[$,L]=A({name:"PresenceContext",hookName:"usePresenceContext",providerName:"<PresenceProvider />"}),[F,Ue]=A({name:"RenderStrategyContext",hookName:"useRenderStrategyContext",providerName:"<RenderStrategyPropsProvider />"}),G=e=>U()(e,["lazyMount","unmountOnExit"]),[W,P]=A({name:"DialogContext",hookName:"useDialogContext",providerName:"<DialogProvider />"}),q=a.forwardRef((e,n)=>{const o=P(),s=Ue(),r=M({...s,present:o.open}),i=f(o.getBackdropProps(),r.getPresenceProps(),e);return r.unmounted?null:t.jsx(j.div,{...i,ref:B(r.ref,n)})});q.displayName="DialogBackdrop";const _=a.forwardRef((e,n)=>{const o=P(),s=f(o.getCloseTriggerProps(),e);return t.jsx(j.button,{...s,ref:n})});_.displayName="DialogCloseTrigger";const K=a.forwardRef((e,n)=>{const o=P(),s=L(),r=f(o.getContentProps(),s.getPresenceProps(),e);return s.unmounted?null:t.jsx(j.div,{...r,ref:B(s.ref,n)})});K.displayName="DialogContent";const Z=a.forwardRef((e,n)=>{const o=P(),s=f(o.getDescriptionProps(),e);return t.jsx(j.div,{...s,ref:n})});Z.displayName="DialogDescription";const J=a.forwardRef((e,n)=>{const o=P(),s=f(o.getPositionerProps(),e);return L().unmounted?null:t.jsx(j.div,{...s,ref:n})});J.displayName="DialogPositioner";const Oe=e=>{const n=a.useId(),{getRootNode:o}=b(),{dir:s}=ye(),r={id:n,getRootNode:o,dir:s,...e},i=O(me,r);return ue(i,we)},Be=e=>{const[n,{children:o,...s}]=V(e),[r]=G(n),i=Oe(s),l=M(f({present:i.open},n));return t.jsx(W,{value:i,children:t.jsx(F,{value:r,children:t.jsx($,{value:l,children:o})})})},be=e=>{const[n,{value:o,children:s}]=V(e),[r]=G(n),i=M(f({present:o.open},n));return t.jsx(W,{value:o,children:t.jsx(F,{value:r,children:t.jsx($,{value:i,children:s})})})},Q=a.forwardRef((e,n)=>{const o=P(),s=f(o.getTitleProps(),e);return t.jsx(j.h2,{...s,ref:n})});Q.displayName="DialogTitle";const X=a.forwardRef((e,n)=>{const o=P(),s=L(),r=f({...o.getTriggerProps(),"aria-controls":s.unmounted?void 0:o.getTriggerProps()["aria-controls"]},e);return t.jsx(j.button,{...r,ref:n})});X.displayName="DialogTrigger";const He=e=>{var u;const{children:n,disabled:o}=e,[s,r]=a.useState((u=e.container)==null?void 0:u.current),i=a.useSyncExternalStore(Ve,()=>!1,()=>!0),{getRootNode:l}=b();if(a.useEffect(()=>{r(()=>{var c;return(c=e.container)==null?void 0:c.current})},[e.container]),i||o)return t.jsx(t.Fragment,{children:n});const p=s??Ie(l);return t.jsx(t.Fragment,{children:a.Children.map(n,c=>pe.createPortal(c,p))})},Ie=e=>{const n=e==null?void 0:e(),o=n.getRootNode();return ge(o)?o:xe(n).body},Ve=()=>()=>{},$e=e=>t.jsxs(S.svg,{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"3",strokeLinecap:"round",strokeLinejoin:"round",...e,children:[t.jsx("path",{d:"m5 12 7-7 7 7"}),t.jsx("path",{d:"M12 19V5"})]}),Fe=e=>t.jsxs(S.svg,{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"3",strokeLinecap:"round",strokeLinejoin:"round",...e,children:[t.jsx("path",{d:"M12 5v14"}),t.jsx("path",{d:"m19 12-7 7-7-7"})]}),Ge=e=>t.jsx(S.svg,{viewBox:"0 0 24 24",fill:"currentColor",...e,children:t.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M18.7071 6.70711C19.0976 6.31658 19.0976 5.68342 18.7071 5.29289C18.3166 4.90237 17.6834 4.90237 17.2929 5.29289L12 10.5858L6.70711 5.29289C6.31658 4.90237 5.68342 4.90237 5.29289 5.29289C4.90237 5.68342 4.90237 6.31658 5.29289 6.70711L10.5858 12L5.29289 17.2929C4.90237 17.6834 4.90237 18.3166 5.29289 18.7071C5.68342 19.0976 6.31658 19.0976 6.70711 18.7071L12 13.4142L17.2929 18.7071C17.6834 19.0976 18.3166 19.0976 18.7071 18.7071C19.0976 18.3166 19.0976 17.6834 18.7071 17.2929L13.4142 12L18.7071 6.70711Z"})}),We=a.forwardRef(function(n,o){return t.jsx(m,{px:"0",py:"0",_icon:{fontSize:"1.2em"},ref:o,...n})}),qe=a.forwardRef(function(n,o){return t.jsx(We,{variant:"ghost","aria-label":"Close",ref:o,...n,children:n.children??t.jsx(Ge,{})})}),{withRootProvider:Y,withContext:g}=H({key:"dialog"});Y(be,{defaultProps:{unmountOnExit:!0,lazyMount:!0}});const _e=Y(Be,{defaultProps:{unmountOnExit:!0,lazyMount:!0}});g(X,"trigger",{forwardAsChild:!0});const Ke=g(J,"positioner",{forwardAsChild:!0}),Ze=g(K,"content",{forwardAsChild:!0});g(Z,"description",{forwardAsChild:!0});const Je=g(Q,"title",{forwardAsChild:!0}),Qe=g(_,"closeTrigger",{forwardAsChild:!0}),Xe=a.forwardRef(function(n,o){const s=P();return t.jsx(S.button,{...n,ref:o,onClick:()=>s.setOpen(!1)})}),Ye=g(q,"backdrop",{forwardAsChild:!0}),et=g("div","body"),tt=g("div","footer"),nt=g("div","header"),{withProvider:ot,withContext:C,PropsProvider:st}=H({key:"stat"}),D=ot("dl","root"),E=C("dt","label"),R=C("dd","valueText");C("span","helpText");C("span","valueUnit");C("span","indicator",{defaultProps:{"data-type":"up",children:t.jsx($e,{})}});C("span","indicator",{defaultProps:{"data-type":"down",children:t.jsx(Fe,{})}});a.forwardRef(function(n,o){const s=De({key:"stat"}),[r,i]=a.useMemo(()=>s.splitVariantProps(n),[n,s]);return t.jsx(st,{value:r,children:t.jsx(S.div,{ref:o,role:"group",display:"flex",flexWrap:"wrap",justifyContent:"space-around",alignItems:"flex-start",...i})})});function rt({open:e,setOpen:n,onRetry:o,setShouldBgmPlay:s,summary:r}){const i=he(),l=fe(),p=ve(),u=Pe();return t.jsx(_e,{open:e,onOpenChange:c=>n(c.open),size:"sm",placement:"center",onExitComplete:()=>{r.killedNow&&l(i+1),n(!1)},children:t.jsxs(He,{children:[t.jsx(Ye,{}),t.jsx(Ke,{children:t.jsxs(Ze,{rounded:"xl",children:[t.jsxs(nt,{children:[t.jsx(Je,{children:"けっか発表"}),t.jsx(Qe,{asChild:!0,children:t.jsx(qe,{size:"sm"})})]}),t.jsxs(et,{children:[t.jsxs(I,{gap:"6",wrap:"wrap",children:[t.jsxs(D,{children:[t.jsx(E,{children:"時間"}),t.jsxs(R,{fontSize:"2xl",children:[r.timeSec,"s"]})]}),!u&&t.jsxs(D,{children:[t.jsx(E,{children:"ヒントを使った問題数"}),t.jsx(R,{fontSize:"2xl",children:r.usedHintCount})]}),t.jsxs(D,{children:[t.jsx(E,{children:"まちがえた問題数"}),t.jsx(R,{fontSize:"2xl",children:r.mistakeProblemCount})]})]}),r.killedNow&&t.jsxs(T,{children:["レベルが",i,"から",i+1,"に上がった"]})]}),t.jsxs(tt,{gap:"2",children:[t.jsx(m,{colorPalette:"blue",onClick:()=>{p&&s(!1),o()},children:"もう一度やる"}),t.jsx(Xe,{asChild:!0,children:t.jsx(m,{variant:"outline",onClick:()=>{p&&s(!0)},children:"とじる"})})]})]})})]})})}const mt={title:"Components/typing/ResultsDialog"},it=({battle:e,level:n,setLevel:o,sound:s,children:r})=>t.jsx(Ce.Provider,{value:e,children:t.jsx(Se.Provider,{value:n,children:t.jsx(Ne.Provider,{value:o,children:t.jsx(ke.Provider,{value:s,children:r})})})}),pt=()=>{const[e,n]=a.useState(!0),[o,s]=a.useState(!0),[r,i]=a.useState(!0),[l,p]=a.useState(3),[u,c]=a.useState(42),[x,v]=a.useState(2),[y,w]=a.useState(1),[N,ee]=a.useState(!0),[te,ne]=a.useState(!1),oe=a.useMemo(()=>({timeSec:u,usedHintCount:x,mistakeProblemCount:y,killedNow:N}),[u,x,y,N]),se=()=>{w(0),v(0),c(0),n(!0),console.log("[ResultsDialog] onRetry called")};return t.jsx(it,{battle:o,level:l,setLevel:p,sound:r,children:t.jsxs(T,{p:"6",children:[t.jsxs(Re,{align:"stretch",gap:"3",mb:"4",children:[t.jsx(je,{size:"md",children:"Playground"}),t.jsxs(I,{gap:"2",flexWrap:"wrap",children:[t.jsx(m,{size:"sm",onClick:()=>n(!0),children:"ダイアログを開く"}),t.jsx(m,{size:"sm",variant:"outline",onClick:()=>n(!1),children:"ダイアログを閉じる"}),t.jsxs(m,{size:"sm",variant:"outline",onClick:()=>s(d=>!d),children:["battle 切替: ",String(o)]}),t.jsxs(m,{size:"sm",variant:"outline",onClick:()=>i(d=>!d),children:["sound 切替: ",String(r)]}),t.jsx(m,{size:"sm",onClick:()=>p(d=>Math.max(1,d-1)),children:"Lv -1"}),t.jsx(m,{size:"sm",onClick:()=>p(d=>d+1),children:"Lv +1"}),t.jsx(m,{size:"sm",onClick:()=>c(d=>Math.max(0,d-5)),children:"timeSec -5"}),t.jsx(m,{size:"sm",onClick:()=>c(d=>d+5),children:"timeSec +5"}),t.jsx(m,{size:"sm",onClick:()=>v(d=>Math.max(0,d-1)),children:"hint -1"}),t.jsx(m,{size:"sm",onClick:()=>v(d=>d+1),children:"hint +1"}),t.jsx(m,{size:"sm",onClick:()=>w(d=>Math.max(0,d-1)),children:"mistake -1"}),t.jsx(m,{size:"sm",onClick:()=>w(d=>d+1),children:"mistake +1"}),t.jsxs(m,{size:"sm",variant:"outline",onClick:()=>ee(d=>!d),children:["killedNow 切替: ",String(N)]})]}),t.jsxs(T,{fontSize:"sm",children:[t.jsx(h,{mr:"2",children:"open"}),String(e),t.jsx(h,{mx:"2",children:"battle"}),String(o),t.jsx(h,{mx:"2",children:"sound"}),String(r),t.jsx(h,{mx:"2",children:"level"}),l,t.jsx(h,{mx:"2",children:"timeSec"}),u,t.jsx(h,{mx:"2",children:"usedHintCount"}),x,t.jsx(h,{mx:"2",children:"mistakeProblemCount"}),y,t.jsx(h,{mx:"2",children:"killedNow"}),String(N),t.jsx(h,{mx:"2",children:"bgmShouldPlay"}),String(te)]}),t.jsx(Te,{}),t.jsxs(Ee,{fontSize:"sm",opacity:.8,children:["・battle=false の場合は「ヒントを使った問題数」が表示されます。",t.jsx("br",{}),"・killedNow=true の場合は「レベルアップ (Lv → Lv+1)」が表示され、閉じる時に useSetLevel によりレベルが+1されます。"]})]}),t.jsx(rt,{open:e,setOpen:n,onRetry:se,setShouldBgmPlay:ne,summary:oe})]})})};typeof window<"u"&&window.document&&window.document.createElement&&document.documentElement.setAttribute("data-storyloaded","");export{pt as Basic,mt as default};
