import{j as e,r as t}from"./index-DvxvgMDz.js";import{B as n,T as r,H as s,a as i}from"./h-stack-CM-3ku_d.js";function b({typed:t,correctMap:r,answer:s,showHint:i}){let a=t.length-1,l=i?s.split(""):t.split("");return e.jsxs(n,{fontFamily:"mono",fontSize:{base:"lg",md:"2xl"},lineHeight:"1.8",wordBreak:"break-word",h:"45px",children:[l.map((s,l)=>{if(!i){if(0===t.length||l>=t.length)return null;if(l===a){let s=r[l]?"blue.solid":"red.solid";return e.jsx(n,{as:"span",color:s,whiteSpace:"pre",children:t[l]},l)}let s=r[l]?"fg":"red.solid";return e.jsx(n,{as:"span",color:s,whiteSpace:"pre",children:t[l]},l)}if(!(l<t.length))return e.jsx(n,{as:"span",color:"gray.focusRing",whiteSpace:"pre",children:s},l);{if(l===a){let s=r[l]?"blue.solid":"red.solid";return e.jsx(n,{as:"span",color:s,whiteSpace:"pre",children:t[l]},l)}let s=r[l]?"fg":"red.solid";return e.jsx(n,{as:"span",color:s,whiteSpace:"pre",children:t[l]},l)}}),0===t.length&&!i&&e.jsx(n,{as:"span",color:"fg.muted",children:"(こたえのスペルをにゅうりょくしてね)"})]})}function y({onKey:e,enabled:n=!0,handleEnter:r=!0,handleBackspace:s=!0,handleSpace:i=!0,handleTab:a=!0}){return t.useEffect(()=>{if(!n)return;let t=t=>{if(n){if(a&&"Tab"===t.key){e("	",t),t.preventDefault();return}if(i&&(" "===t.key||"Space"===t.code)){e(" ",t),t.preventDefault();return}if(1===t.key.length){e(t.key,t),t.preventDefault();return}if(s&&"Backspace"===t.key){e("\b",t),t.preventDefault();return}if(r&&"Enter"===t.key){e(`
`,t),t.preventDefault();return}}};return window.addEventListener("keydown",t,{capture:!0}),()=>window.removeEventListener("keydown",t,{capture:!0})},[e,n,r,s,i,a]),null}function O({typed:t,correctMap:s,answer:i,showHint:a,state:l,inputOnKey:o,resultOpen:d,engine:p}){return e.jsxs(e.Fragment,{children:[e.jsxs(n,{p:"4",rounded:"xl",borderWidth:"1px",bg:"bg.panel",h:"109px",children:[e.jsx(b,{typed:t,correctMap:s,answer:i,showHint:a}),e.jsx(r,{mt:"2",fontSize:"sm",color:"fg.muted",children:"スペースキー: 次のたん語 / エンターキー: はじめる、おわる / バックスペースキー: 1文字消す / タブキー: ヒント"})]}),e.jsx(y,{enabled:!l.finished&&!d,onKey:(e,t)=>{if(e===`
`)if(t.preventDefault(),l.started){if(!l.finished)return void p.stop()}else p.start();o(e)}})]})}function v(e="apple"){let[n]=t.useState(e),[r,s]=t.useState(""),[i,a]=t.useState(!1),[l,o]=t.useState(!1),[d,p]=t.useState(!1),[u,c]=t.useState(!1),h=t.useMemo(()=>({started:d,finished:u}),[d,u]),f=t.useMemo(()=>{let e=[];for(let t=0;t<r.length;t++)e.push(r[t]===n[t]);return e},[r,n]);return{typed:r,correctMap:f,answer:n,showHint:i,state:h,inputOnKey:e=>{if(!u){if(" "===e)return void s("");if("\b"===e)return void s(e=>e.slice(0,-1));1===e.length&&/^[a-zA-Z]$/.test(e)&&s(t=>(t+e).toLowerCase())}},resultOpen:l,engine:{start:()=>{p(!0),c(!1)},stop:()=>{c(!0)}},setShowHint:a,setResultOpen:o,reset:()=>{s(""),a(!1),o(!1),p(!1),c(!1)}}}let H={title:"Components/typing/AnswerArea"},B=()=>{let t=v("apple");return e.jsxs(n,{p:"6",children:[e.jsxs(s,{gap:"2",mb:"3",children:[e.jsx(i,{size:"sm",onClick:()=>t.engine.start(),children:"開始 (engine.start)"}),e.jsx(i,{size:"sm",onClick:()=>t.engine.stop(),disabled:!t.state.started||t.state.finished,children:"終了 (engine.stop)"}),e.jsx(i,{size:"sm",onClick:()=>t.setShowHint(e=>!e),children:"ヒント切替"}),e.jsx(i,{size:"sm",onClick:()=>t.setResultOpen(e=>!e),children:"結果ダイアログ切替"}),e.jsx(i,{size:"sm",variant:"outline",onClick:t.reset,children:"リセット"})]}),e.jsxs(r,{fontSize:"sm",mb:"2",children:["デモ用 Answer: ",e.jsx("b",{children:t.answer})," / typed: ",e.jsx("b",{children:t.typed})," / started: ",String(t.state.started)," / finished:"," ",String(t.state.finished)," / resultOpen: ",String(t.resultOpen)," / hint: ",String(t.showHint)]}),e.jsx(O,{typed:t.typed,correctMap:t.correctMap,answer:t.answer,showHint:t.showHint,state:t.state,inputOnKey:t.inputOnKey,resultOpen:t.resultOpen,engine:t.engine})]})};"u">typeof window&&window.document&&window.document.createElement&&document.documentElement.setAttribute("data-storyloaded","");export{B as Basic,H as default};