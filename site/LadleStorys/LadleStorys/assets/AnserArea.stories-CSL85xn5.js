import{j as n,r as u}from"./index-DvxvgMDz.js";import{B as c,T as g,H as k,a as m}from"./h-stack-CM-3ku_d.js";function b({typed:e,correctMap:s,answer:i,showHint:r}){const o=e.length-1,l=r?i.split(""):e.split("");return n.jsxs(c,{fontFamily:"mono",fontSize:{base:"lg",md:"2xl"},lineHeight:"1.8",wordBreak:"break-word",h:"45px",children:[l.map((d,t)=>{if(!r){if(e.length===0||t>=e.length)return null;if(t===o){const p=s[t]?"blue.solid":"red.solid";return n.jsx(c,{as:"span",color:p,whiteSpace:"pre",children:e[t]},t)}const a=s[t]?"fg":"red.solid";return n.jsx(c,{as:"span",color:a,whiteSpace:"pre",children:e[t]},t)}if(t<e.length){if(t===o){const p=s[t]?"blue.solid":"red.solid";return n.jsx(c,{as:"span",color:p,whiteSpace:"pre",children:e[t]},t)}const a=s[t]?"fg":"red.solid";return n.jsx(c,{as:"span",color:a,whiteSpace:"pre",children:e[t]},t)}else return n.jsx(c,{as:"span",color:"gray.focusRing",whiteSpace:"pre",children:d},t)}),e.length===0&&!r&&n.jsx(c,{as:"span",color:"fg.muted",children:"(こたえのスペルをにゅうりょくしてね)"})]})}function y({onKey:e,enabled:s=!0,handleEnter:i=!0,handleBackspace:r=!0,handleSpace:o=!0,handleTab:l=!0}){return u.useEffect(()=>{if(!s)return;const d=t=>{if(s){if(l&&t.key==="Tab"){e("	",t),t.preventDefault();return}if(o&&(t.key===" "||t.code==="Space")){e(" ",t),t.preventDefault();return}if(t.key.length===1){e(t.key,t),t.preventDefault();return}if(r&&t.key==="Backspace"){e("\b",t),t.preventDefault();return}if(i&&t.key==="Enter"){e(`
`,t),t.preventDefault();return}}};return window.addEventListener("keydown",d,{capture:!0}),()=>window.removeEventListener("keydown",d,{capture:!0})},[e,s,i,r,o,l]),null}function O({typed:e,correctMap:s,answer:i,showHint:r,state:o,inputOnKey:l,resultOpen:d,engine:t}){return n.jsxs(n.Fragment,{children:[n.jsxs(c,{p:"4",rounded:"xl",borderWidth:"1px",bg:"bg.panel",h:"109px",children:[n.jsx(b,{typed:e,correctMap:s,answer:i,showHint:r}),n.jsx(g,{mt:"2",fontSize:"sm",color:"fg.muted",children:"スペースキー: 次のたん語 / エンターキー: はじめる、おわる / バックスペースキー: 1文字消す / タブキー: ヒント"})]}),n.jsx(y,{enabled:!o.finished&&!d,onKey:(a,p)=>{if(a===`
`){if(p.preventDefault(),!o.started)t.start();else if(!o.finished){t.stop();return}}l(a)}})]})}function v(e="apple"){const[s]=u.useState(e),[i,r]=u.useState(""),[o,l]=u.useState(!1),[d,t]=u.useState(!1),[a,p]=u.useState(!1),[w,x]=u.useState(!1),j=u.useMemo(()=>({started:a,finished:w}),[a,w]),S=u.useMemo(()=>{const f=[];for(let h=0;h<i.length;h++)f.push(i[h]===s[h]);return f},[i,s]);return{typed:i,correctMap:S,answer:s,showHint:o,state:j,inputOnKey:f=>{if(!w){if(f===" "){r("");return}if(f==="\b"){r(h=>h.slice(0,-1));return}f.length===1&&/^[a-zA-Z]$/.test(f)&&r(h=>(h+f).toLowerCase())}},resultOpen:d,engine:{start:()=>{p(!0),x(!1)},stop:()=>{x(!0)}},setShowHint:l,setResultOpen:t,reset:()=>{r(""),l(!1),t(!1),p(!1),x(!1)}}}const H={title:"Components/typing/AnswerArea"},B=()=>{const e=v("apple");return n.jsxs(c,{p:"6",children:[n.jsxs(k,{gap:"2",mb:"3",children:[n.jsx(m,{size:"sm",onClick:()=>e.engine.start(),children:"開始 (engine.start)"}),n.jsx(m,{size:"sm",onClick:()=>e.engine.stop(),disabled:!e.state.started||e.state.finished,children:"終了 (engine.stop)"}),n.jsx(m,{size:"sm",onClick:()=>e.setShowHint(s=>!s),children:"ヒント切替"}),n.jsx(m,{size:"sm",onClick:()=>e.setResultOpen(s=>!s),children:"結果ダイアログ切替"}),n.jsx(m,{size:"sm",variant:"outline",onClick:e.reset,children:"リセット"})]}),n.jsxs(g,{fontSize:"sm",mb:"2",children:["デモ用 Answer: ",n.jsx("b",{children:e.answer})," / typed: ",n.jsx("b",{children:e.typed})," / started: ",String(e.state.started)," / finished:"," ",String(e.state.finished)," / resultOpen: ",String(e.resultOpen)," / hint: ",String(e.showHint)]}),n.jsx(O,{typed:e.typed,correctMap:e.correctMap,answer:e.answer,showHint:e.showHint,state:e.state,inputOnKey:e.inputOnKey,resultOpen:e.resultOpen,engine:e.engine})]})};typeof window<"u"&&window.document&&window.document.createElement&&document.documentElement.setAttribute("data-storyloaded","");export{B as Basic,H as default};
